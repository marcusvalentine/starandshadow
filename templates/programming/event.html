{% extends "programming/eventtype.html" %}
{% load programme_filters %}
{% load thumbnail %}

{% block centralContent %}

    <div class="eventtype editthis" itemscope itemtype="http://schema.org/Event" data-apiurl="{{ event.api_url }}" data-modeltype="Event" data-modelid="{{ event.id }}">
        <meta itemprop="description" content="{{ event.summary|safe|striptags }}"/>
        <meta itemprop="url" content="{{ event.get_absolute_url }}"/>
        <meta itemscope itemprop="location" itemref="thestarandshadowcinemaaddress" content="thestarandshadowcinemaaddress"/>

        <header>
            <h1>
                <span itemprop="name" data-modelfield="title" data-fieldtype="CharField">{{ maintitle|title }}</span>
            </h1>
        </header>

        {% if event.picture %}
            {% thumbnail event.picture.file "400" as im %}
                <img class="imgright"
                     data-modelfield="picture"
                     data-fieldtype="ForeignKeyPicture"
                     data-fieldvalue="{{ event.picture.id }}"
                     data-fieldapiurl="{{ event.picture.api_list_url }}"
                     itemprop="image"
                     src="{{ im.url }}"
                     data-src="{{ event.picture.get_img_url }}"
                     data-width="{{ event.picture.file.width }}"
                     data-height="{{ event.picture.file.height }}"
                     alt=""
                     width="{{ im.width }}"
                     height="{{ im.height }}">
            {% endthumbnail %}
        {% else %}
            <img class="imgright"
                 data-modelfield="picture"
                 data-fieldtype="ForeignKeyPicture"
                 data-fieldvalue="789"
                 data-fieldapiurl="/api/select/graphic/"
                 itemprop="image"
                 src="/static/img/events/filler.png"
                 data-src=""
                 alt=""
                 width="400"
                 height="400"
                 hidden>
        {% endif %}

        {% if event.festival_set.all|length != 0 %}
            {% for festival in event.festival_set.all %}
                <h3 itemprop="superEvent" itemscope itemtype="http://schema.org/Event" data-apiurl="{{ festival.get_api_url }}" data-modelid="{{ festival.id }}">
                    Part of <a itemprop="url" href="{{ festival.get_absolute_url }}"><span itemprop="name">{{ festival }}</span></a>
                </h3>
            {% endfor %}
        {% endif %}

        <h3 data-whileediting="hide">
            <time itemprop="startDate" datetime="{{ event.startDateTime|date:"c"|slice:":19" }}{{ event.startDateTime|date:"O" }}">{{ event.displayStart }}</time>
            {% ifnotequal event.displayStart '' %} to {% endifnotequal %}
            <time itemprop="endDate" datetime="{{ event.endDateTime|date:"c"|slice:":19" }}{{ event.startDateTime|date:"O" }}">{{ event.displayEnd }}</time>
        </h3>
        {% if authenticated %}
            <h3 data-whileediting="show" hidden style="display: none;">
                <span data-modelfield="startDate" data-fieldtype="DateField" data-fieldvalue="{{ event.startDate|date:"SHORT_DATE_FORMAT" }}">{{ event.startDate|date:"SHORT_DATE_FORMAT" }}</span>
                <span data-modelfield="startTime" data-fieldtype="TimeField" data-fieldvalue="{{ event.startTime|date:"SHORT_TIME_FORMAT" }}">{{ event.startTime|date:"SHORT_TIME_FORMAT" }}</span>
                to <span data-modelfield="endTime" data-fieldtype="TimeField" data-fieldvalue="{{ event.endTime|date:"SHORT_TIME_FORMAT" }}">{{ event.endTime|date:"SHORT_TIME_FORMAT" }}</span>
            </h3>
        {% endif %}

        <table>
            <tbody>
                {% if authenticated %}
                    <tr itemscope itemtype="http://schema.org/Person">
                        <td>Programmer:</td>
                        <td>
                            <span data-modelfield="programmer" data-fieldtype="ForeignKey" data-fieldvalue="{{ event.programmer.id }}" data-fieldapiurl="{{ event.programmer.api_list_url }}">
                                <a itemprop="url" href="{{ event.programmer.get_absolute_url }}">
                                    <span itemprop="name">{{ event.programmer.name }}</span>
                                </a>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td>Public/Private:</td>
                        <td><span data-modelfield="private" data-fieldtype="BooleanField" data-iftrue="Private" data-iffalse="Public"{% if event.private %} class="true">Private{% else %} class="false">Public{% endif %}</span></td>
                    </tr>
                {% endif %}
                <tr data-whileediting="show" hidden style="display: none;">
                    <td>Summary:</td>
                    <td class="summary" itemprop="description" data-modelfield="summary" data-fieldtype="PlainTextField">{{ event.summary|safe|striptags }}</td>
                </tr>
            </tbody>
        </table>

        <div class="bodysection">
            <div class="body" data-modelfield="body" data-fieldtype="TextField">{{ event.body|sanitize }}</div>
        </div>

        <div itemprop="subEvents" itemscope itemtype="http://schema.org/Event">
            <meta itemprop="name" content="{{ event.title }}">
            <a itemprop="url" data-modelfield="website" data-fieldtype="URLField" href="{{ event.website }}">{{ event.website }}</a>
        </div>

    </div>

{% endblock %}
